<!doctype html>
<html lang="en">

<head>
    <title>Title</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&family=Luckiest+Guy&display=swap"
        rel="stylesheet">
    <style>
        html,
        body {
            height: 90%;
            background-color: #00BFFF97;
        }

        .card-title-header {
            font-family: 'Luckiest Guy', cursive;
            font-size: x-large;
        }

        .top-header {
            font-family: 'Luckiest Guy', cursive;
            font-size: 50pt;
            padding-left: 40%;
            color: white;
        }

        #questions-sets {
            /* margin-top: 5%; */
        }
    </style>
</head>

<body>
    <section id="header" class="header">
        <h1 class="top-header">Our Game!</h1>
    </section>
    <section id="question-sets" class="container-fluid">
        <form action="/sendQuestionsFromHost" method="GET" style="float: left;">
            <input class="btn btn-primary card-title-header" type="submit" value="Start Game">
        </form>
        <form action="/host-logout" method="GET">
            <input class="btn btn-primary card-title-header" type="submit" value="Log out!">
        </form>
        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div id="questions-set-header" class="col-md-6 card-title-header">
                                Question Sets
                            </div>
                            <div class="col-md-6">
                                <!-- Button trigger modal -->
                                <button type="button" class="btn btn-primary card-title-header" data-toggle="modal"
                                    data-target="#exampleModal" style="height: 45px;">
                                    Create Set
                                </button>

                                <!-- Modal -->
                                <div class="modal fade" data-backdrop="static" id="exampleModal" tabindex="-1" role="dialog"
                                    aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">Enter Set Name</h5>
                                                <!-- <button type="button" class="close" data-dismiss="modal"
                                                    aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button> -->
                                            </div>
                                            <div class="modal-body">
                                                <form action="/insertQuestion" id="set-form" method="POST">
                                                    <div class="form-group">
                                                        <input id="set-input" class="form-control set-input form-input" name="collectionname" type="text" placeholder="Set Name" required/>
                                                    </div>
                                                    <div class="form-group">
                                                        <input id="question-input" class="form-control question-input form-input" name="question" type="text" placeholder="question" required/>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input form-input" type="radio" name="answerindex" id="answerindex1" value="1" required>
                                                        <input id="answer-input1" class="form-control answer-input form-input" name="answer0" type="text" placeholder="Answer 1" required/>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input form-input" type="radio" name="answerindex" id="answerindex2" value="2" required>
                                                        <input id="answer-input2" class="form-control answer-input form-input" name="answer1" type="text" placeholder="Answer 2" required/>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input form-input" type="radio" name="answerindex" id="answerindex3" value="3" required>
                                                        <input id="answer-input3" class="form-control answer-input form-input" name="answer2" type="text" placeholder="Answer 2" required/>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input form-input" type="radio" name="answerindex" id="answerindex4" value="4" required>
                                                        <input id="answer-input4" class="form-control answer-input form-input" name="answer3" type="text" placeholder="Answer 3" required/>
                                                    </div>
                                                    <br>
                                                    <button type="submit" class="btn btn-primary">Submit</button>
                                                  </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button id="set-cancel" type="button" class="btn btn-secondary set-cancel"
                                                    data-dismiss="modal">Cancel
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <ul id="questions-set-list" class="list-group">

                </ul>
            </div>
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body card-title-header">
                        <div class="row">
                            <div id="questions-header" class="col-md-6">
                                Choose Set
                            </div>
                            <div class="col-md-6">   
                                <button id="add-question-button" type="button"
                                    class="btn btn-primary card-title-header" data-toggle="modal"
                                    data-target="#exampleModal2" style="height: 45px;">
                                    Add New Question
                                </button>
                                <!-- <button id="btn-start-game" type="button" class="btn btn-primary card-title-header" style="height: 45px;">
                                    Start Game
                                </button> -->
                            </div>
                            <!-- Modal -->
                            <div class="modal fade" data-backdrop="static" id="exampleModal2" tabindex="-1" role="dialog"
                            aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Enter Question</h5>
                                        <!-- <button type="button" class="close" data-dismiss="modal"
                                            aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button> -->
                                    </div>
                                    <div class="modal-body">
                                        <form action="/insertQuestion" id="question-form" method="POST">
                                            <div class="form-group">
                                                <input id="q-set-input" class="form-control set-input" name="collectionname" type="text" placeholder="Set Name" readonly/>
                                            </div>
                                            <div class="form-group">
                                                <input id="q-question" class="form-control question-input" name="question" type="text" placeholder="question" required/>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="answerindex" id="answerindex1" value="1" required>
                                                <input id="q-answer-input1" class="form-control answer-input" name="answer0" type="text" placeholder="Answer 1" required/>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="answerindex" id="answerindex2" value="2" required>
                                                <input id="q-answer-input2" class="form-control answer-input" name="answer1" type="text" placeholder="Answer 2" required/>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="answerindex" id="answerindex3" value="3" required>
                                                <input id="q-answer-input3" class="form-control answer-input" name="answer2" type="text" placeholder="Answer 2" required/>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="answerindex" id="answerindex4" value="4">
                                                <input id="q-answer-input4" class="form-control answer-input" name="answer3" type="text" placeholder="Answer 3" required/>
                                            </div>
                                            <br>
                                            <button type="submit" class="btn btn-primary">Submit</button>
                                          </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="set-cancel-2" type="button" class="btn btn-secondary set-cancel"
                                            data-dismiss="modal">Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
                <div id="accordianId" role="tablist" aria-multiselectable="true">

                </div>
            </div>
        </div>
        </div>
    </section>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.5.0.min.js"
        integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
    </script>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script>
        $(document).ready(function() {
            var socket = io();
            var setIndex;
            var qt = [] //Questions Set Array

            // Question Set List Item Clicked (Left Side)
            $(".question-set-item").on("click", function(e) {
                setIndex = e.target.getAttribute('data-index')
                FillQuestions(setIndex);
                SetQuestionSet(questions[setIndex].set)
            });

            // Create a List of Question Set Names (Left Side Panel)
            function FillSet() {
                $('#questions-set-list').html('')
                for (var index in qt) {
                    $('#questions-set-list').append('<li id="question-set-item-' + index + '" data-index=' + index +
                        ' class="list-group-item question-set-item">' + qt[index].set + '</li>')
                }
                // Add Event Listener to new List
                document.getElementById("questions-set-list").addEventListener("click", function(e) {
                    if (e.target && e.target.nodeName == "LI") {
                        var index = e.target.getAttribute('data-index')
                        setIndex = index
                        setIndex = e.target.getAttribute('data-index')
                        GetQuestions(qt[setIndex].set, setIndex)
                        SetQuestionSet(qt[setIndex].set)
                    }
                })
            }

            // Add to Question List belonging to a set (Right Side Panel)
            function FillQuestions(index) {
                $('#accordianId').html('')
                var question = qt[index];
                $('#questions-header').html(question.set)
                for (var i in question.questions) {
                    // ADD A DROP DOWN LIST PER QUESTION
                    var questionCardItem = '<div class="card">' +
                        '<div class="card-header card-title-header" role="tab" id="section' + i + 'HeaderId">' +
                        '<h5 class="mb-0">' +
                        '<a data-toggle="collapse" data-parent="#accordianId" href="#section' + i +
                        'ContentId"' +
                        'aria-expanded="true" aria-controls="section' + i + 'ContentId">' +
                        question.questions[i].question +
                        '</a>' +
                        '</h5>' +
                        '</div>' +
                        '<div id="section' + i + 'ContentId" class="collapse in" role="tabpanel"' +
                        'aria-labelledby="section1HeaderId">' +
                        '<ul id="list-group-' + i + '" class="list-group">' +
                        '</ul>' +
                        '</div>' +
                        '</div>'

                    $('#accordianId').append(questionCardItem)
                }
                // Add questions to Accordian List
                for (var item in question.questions) {
                    for (var answer in question.questions[item].answers) {
                        $('#list-group-' + item).append('<li class="list-group-item question-set-item">' +
                            question.questions[item].answers[answer] + '</li>')
                    }
                }
            }

            // Modal Cancel Button Pressed
            $('.set-cancel').click(function(e) {
                var inputs = $('input').not(':input[type=submit]')
                inputs.val('')
            })

            // Will Set Chosen Question Set on Server
            function SetQuestionSet(str) {
                test = {
                    doc: str
                }
                console.log('setting')
                $.ajax({
                    url: '/setquestionset',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(test)
                })
            }

            // Will get Collection Names that belong to logged in user from server
            $.getJSON('/getCollections', function(data, textStatus) {
                var set;
                for (set in data) {
                    qt.push({
                        set: data[set],
                        questions: []
                    })
                }
                console.log('hhhhhhhhhhhhhhheeeerre')
                FillSet()
            })

            // Gets all questions from user question sets
            function GetQuestions(setName, index) {
                console.log('getting questions for ' + setName + ' at index ' + index)
                $.ajax({
                    url: '/getquestions',
                    type: 'GET',
                    contentType: 'application/json',
                    data: {
                        collection: setName
                    },
                    success: function(response) {
                        qt[index].questions = response
                        FillQuestions(index)
                    },
                    error: function(xhr) {
                        //Do Something to handle error
                    }
                })

                // Set Collection Name to input field (which is disabled by default)
                $('#add-question-button').click(function (e) { 
                    $('#q-set-input').attr("placeholder", $('#questions-header').text());
                    $('#q-set-input').attr("value", $('#questions-header').text());
                    e.preventDefault();
                });
            }
        });
    </script>
</body>

</html>